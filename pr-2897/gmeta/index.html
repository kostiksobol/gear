<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Crate for providing metadata for Gear programs."><title>gmeta - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-ba5701c5741a7b69.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="gmeta" data-themes="" data-resource-suffix="" data-rustdoc-version="1.71.0-nightly (f5559e338 2023-04-24)" data-search-js="search-618e954b235f6acc.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-6f6ffb5395b17c6e.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../static.files/storage-62ce34ea385b278a.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-f0540c1d82cde29b.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../gmeta/index.html"><img src="https://docs.gear.rs/logo.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../gmeta/index.html"><img src="https://docs.gear.rs/logo.svg" alt="logo"></a><h2 class="location"><a href="#">Crate gmeta</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.2.2</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">gmeta</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/gmeta/lib.rs.html#19-487">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Crate for providing metadata for Gear programs.</p>
<p>Metadata is used to describe the interface of a Gear program. For example,
it can be used when uploading a contract using <a href="https://idea.gear-tech.io">https://idea.gear-tech.io</a>.
The metadata informs the user about the contract’s interface and allows them
to interact with it using custom types on web applications UI.</p>
<p>Another use case is to parse metadata in JavaScript using the <code>gear-js</code>
library and get the metadata details for some custom UI.</p>
<p>Note that metadata is not required for a Gear program to work. It is only
used to provide additional information about the contract. Also, metadata
can be used for various purposes but we will focus on the use cases related
to the <a href="https://idea.gear-tech.io">https://idea.gear-tech.io</a>.</p>
<p>To generate a metadata output file for a contract, you need:</p>
<ul>
<li>Add <code>gmeta</code> crate to your <code>Cargo.toml</code> file.</li>
<li>Define an empty struct that will identify the contract metadata.</li>
<li>Implement the <a href="trait.Metadata.html" title="trait gmeta::Metadata"><code>Metadata</code></a> trait for this struct by defining the
associated types of the trait.</li>
<li><strong>Option 1</strong>: Call <a href="https://docs.gear.rs/gear_wasm_builder/fn.build_with_metadata.html"><code>gear_wasm_builder::build_with_metadata</code></a>
function in <code>build.rs</code> file.</li>
<li><strong>Option 2</strong>: Convert metadata to hex string using <a href="struct.MetadataRepr.html#method.hex" title="method gmeta::MetadataRepr::hex"><code>MetadataRepr::hex</code></a>
function and write it to the text file.</li>
</ul>
<h2 id="examples"><a href="#examples">Examples</a></h2>
<p>In this example we will create a simple ping-pong contract. Let’s define
message types and metadata in a separate <code>ping-io</code> crate to be able to use
it in both program and <code>build.rs</code> files.</p>
<p>We will define message types for <code>handle()</code> and <code>state()</code> functions.</p>
<ul>
<li><code>ping-io</code> crate:</li>
</ul>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[no_std]
</span><span class="kw">use </span>gmeta::{InOut, Metadata};
<span class="kw">use </span>gstd::prelude::<span class="kw-2">*</span>;

<span class="comment">// Message type for `handle()` function.
</span><span class="attr">#[derive(Encode, Decode, TypeInfo)]
</span><span class="kw">pub enum </span>PingPong {
    Ping,
    Pong,
}

<span class="comment">// Metadata struct.
</span><span class="kw">pub struct </span>ContractMetadata;

<span class="kw">impl </span>Metadata <span class="kw">for </span>ContractMetadata {
    <span class="comment">// The unit tuple is used as neither incoming nor outgoing messages are
    // expected in the `init()` function.
    </span><span class="kw">type </span>Init = ();
    <span class="comment">// We use the same `PingPong` type for both incoming and outgoing
    // messages.
    </span><span class="kw">type </span>Handle = InOut&lt;PingPong, PingPong&gt;;
    <span class="comment">// The unit tuple is used as we don&#39;t use asynchronous interaction in this
    // contract.
    </span><span class="kw">type </span>Others = ();
    <span class="comment">// The unit tuple is used as we don&#39;t process any replies in this contract.
    </span><span class="kw">type </span>Reply = ();
    <span class="comment">// The unit tuple is used as we don&#39;t process any signals in this contract.
    </span><span class="kw">type </span>Signal = ();
    <span class="comment">// We return a counter value (`i32`) in the `state()` function in this contract.
    </span><span class="kw">type </span>State = i32;
}</code></pre></div>
<ul>
<li><code>ping</code> program crate:</li>
</ul>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[no_std]
</span><span class="kw">use </span>gmeta::{InOut, Metadata};
<span class="kw">use </span>gstd::{msg, prelude::<span class="kw-2">*</span>};
<span class="kw">use </span>ping_io::PingPong;

<span class="comment">// Counter that will be incremented on each `Ping` message.
</span><span class="kw">static </span><span class="kw-2">mut </span>COUNTER: i32 = <span class="number">0</span>;

<span class="attr">#[no_mangle]
</span><span class="kw">extern </span><span class="string">&quot;C&quot; </span><span class="kw">fn </span>handle() {
    <span class="comment">// Load incoming message of `PingPong` type.
    </span><span class="kw">let </span>payload: PingPong = msg::load().expect(<span class="string">&quot;Unable to load&quot;</span>);

    <span class="kw">if let </span>PingPong::Ping = payload {
        <span class="kw">unsafe </span>{ COUNTER += <span class="number">1 </span>};
        <span class="comment">// Send a reply message of `PingPong` type back to the sender.
        </span>msg::reply(PingPong::Pong, <span class="number">0</span>).expect(<span class="string">&quot;Unable to reply&quot;</span>);
    }
}

<span class="attr">#[no_mangle]
</span><span class="kw">extern </span><span class="string">&quot;C&quot; </span><span class="kw">fn </span>state() {
    msg::reply(<span class="kw">unsafe </span>{ COUNTER }, <span class="number">0</span>).expect(<span class="string">&quot;Unable to reply&quot;</span>);
}</code></pre></div>
<ul>
<li><code>build.rs</code> file:</li>
</ul>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>ping_io::ContractMetadata;

<span class="kw">fn </span>main() {
    gear_wasm_builder::build_with_metadata::&lt;ContractMetadata&gt;();
}</code></pre></div>
<p>You can also generate metadata manually and write it to the file without
using <code>build.rs</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>gmeta::Metadata;
<span class="kw">use </span>ping_io::ContractMetadata;
<span class="kw">use </span>std::fs;

<span class="kw">let </span>metadata_hex = ContractMetadata::repr().hex();
<span class="macro">assert_eq!</span>(metadata_hex.len(), <span class="number">144</span>);
fs::write(<span class="string">&quot;ping.meta.txt&quot;</span>, metadata_hex).expect(<span class="string">&quot;Unable to write&quot;</span>);</code></pre></div>
<p>You can parse generated metadata file using <code>gear-js</code> API in JavaScript:</p>
<div class="example-wrap"><pre class="language-javascript"><code>import { getProgramMetadata } from &#39;@gear-js/api&#39;;
import { readFileSync } from &#39;fs&#39;;

const metadataHex = readFileSync(&#39;ping.meta.txt&#39;, &#39;utf-8&#39;);
const metadata = getProgramMetadata(&#39;0x&#39; + metadataHex);

console.log(&#39;Registry:&#39;, metadata.regTypes);
console.log(&#39;Types:&#39;, metadata.types);
</code></pre></div>
<p>This will print the following:</p>
<div class="example-wrap"><pre class="language-text"><code>Registry: Map(2) {
  0 =&gt; { name: &#39;RustOutPingPong&#39;, def: &#39;{&quot;_enum&quot;:[&quot;Ping&quot;,&quot;Pong&quot;]}&#39; },
  1 =&gt; { name: &#39;i32&#39;, def: null }
}
Types: {
  init: { input: null, output: null },
  handle: { input: 0, output: 0 },
  reply: { input: null, output: null },
  others: { input: null, output: null },
  signal: null,
  state: 1
}
</code></pre></div></div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.MetaType.html" title="struct gmeta::MetaType">MetaType</a></div><div class="desc docblock-short">A metatype abstraction.</div></li><li><div class="item-name"><a class="struct" href="struct.MetadataRepr.html" title="struct gmeta::MetadataRepr">MetadataRepr</a></div><div class="desc docblock-short">Metadata internal representation.</div></li><li><div class="item-name"><a class="struct" href="struct.MetawasmData.html" title="struct gmeta::MetawasmData">MetawasmData</a></div><div class="desc docblock-short">Metawasm data.</div></li><li><div class="item-name"><a class="struct" href="struct.PortableRegistry.html" title="struct gmeta::PortableRegistry">PortableRegistry</a></div><div class="desc docblock-short">A read-only registry containing types in their portable form for serialization.</div></li><li><div class="item-name"><a class="struct" href="struct.Registry.html" title="struct gmeta::Registry">Registry</a></div><div class="desc docblock-short">The registry for space-efficient storage of type identifiers and
definitions.</div></li><li><div class="item-name"><a class="struct" href="struct.TypesRepr.html" title="struct gmeta::TypesRepr">TypesRepr</a></div><div class="desc docblock-short">Types representation used by metadata.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.LanguageId.html" title="enum gmeta::LanguageId">LanguageId</a></div><div class="desc docblock-short">Language identifier.</div></li><li><div class="item-name"><a class="enum" href="enum.MetadataParseError.html" title="enum gmeta::MetadataParseError">MetadataParseError</a></div><div class="desc docblock-short">Error that can occur during metadata parsing.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.Metadata.html" title="trait gmeta::Metadata">Metadata</a></div><div class="desc docblock-short">Trait used for defining metadata.</div></li><li><div class="item-name"><a class="trait" href="trait.Type.html" title="trait gmeta::Type">Type</a></div><div class="desc docblock-short">Trait used to get information about types.</div></li><li><div class="item-name"><a class="trait" href="trait.Types.html" title="trait gmeta::Types">Types</a></div><div class="desc docblock-short">Trait used for registering types in registry.</div></li></ul><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.In.html" title="type gmeta::In">In</a></div><div class="desc docblock-short">Type alias for incoming message type without any outgoing type.</div></li><li><div class="item-name"><a class="type" href="type.InOut.html" title="type gmeta::InOut">InOut</a></div><div class="desc docblock-short">Type alias for incoming/outgoing message types.</div></li><li><div class="item-name"><a class="type" href="type.Out.html" title="type gmeta::Out">Out</a></div><div class="desc docblock-short">Type alias for outgoing message type without any incoming type.</div></li></ul></section></div></main></body></html>